CREATE DATABASE carcare;

USE carcare;

CREATE TABLE employee(
	employee_id varchar(255) NOT NULL,
    apply_status varchar(255) NOT NULL DEFAULT "pending",
    phone char(10) NOT NULL,
    email varchar(255) NOT NULL,
    picture_url varchar(255) NOT NULL,
    firstwork_time BIGINT(11) UNSIGNED NULL,
    lastlogin_time BIGINT(11) UNSIGNED NULL,
    work_background varchar(255) NOT NULL,
    graduation_certificate varchar(255) NOT NULL,
    prefixname varchar(255) NOT NULL,
    fname varchar(255) NOT NULL,
    lname varchar(255) NOT NULL,
    nickname varchar(255) NOT NULL,
    wage_type varchar(255) NOT NULL,
    employee_type varchar(255) NOT NULL,
    address varchar(255) NOT NULL,
    id_card varchar(255) NOT NULL,
    resume varchar(255) NOT NULL,
    house_registration varchar(255) NOT NULL,
    PRIMARY KEY (employee_id)

);

CREATE TABLE employee_wage(
	wage_type varchar(255) NOT NULL ,
    wage_amount int(11) NOT NULL,
    PRIMARY KEY (wage_type)
);

ALTER TABLE employee
ADD CONSTRAINT eew
    	FOREIGN KEY (wage_type)
    	REFERENCES employee_wage(wage_type)
    	ON DELETE NO ACTION
    	ON UPDATE CASCADE;

CREATE TABLE workleave(
    employee_id varchar(255) NOT NULL PRIMARY KEY,
    timestamp BIGINT(11) UNSIGNED NULL,
    description varchar(255) NOT NULL,
    workleave_type varchar(255) NOT NULL,
    starttime BIGINT(11) UNSIGNED NULL,
    endtime BIGINT(11) UNSIGNED NULL,
    CONSTRAINT wle FOREIGN KEY (employee_id) 
    REFERENCES employee(employee_id)
    ON UPDATE CASCADE
    ON DELETE NO ACTION
);

CREATE TABLE worktime(
	employee_id varchar(255) NOT NULL,
    starttime BIGINT(11) UNSIGNED NULL,
    endtime BIGINT(11) UNSIGNED NULL,
    location_start varchar(255) NOT NULL,
    location_end varchar(255) NOT NULL,
    PRIMARY KEY (employee_id),
    CONSTRAINT wte FOREIGN KEY (employee_id) 
    REFERENCES employee(employee_id)
    ON UPDATE CASCADE
    ON DELETE NO ACTION
);

CREATE TABLE history_salary(
	employee_id varchar(255) NOT NULL,
    timestamp BIGINT(11) UNSIGNED NULL,
    salary BIGINT(11) UNSIGNED NOT NULL,
    overtime BIGINT(11) UNSIGNED NOT NULL,
    commission BIGINT(11) UNSIGNED NOT NULL,
    PRIMARY KEY (employee_id),
    CONSTRAINT hse FOREIGN KEY (employee_id) 
    REFERENCES employee(employee_id)
    ON UPDATE CASCADE
    ON DELETE NO ACTION
);

CREATE TABLE commission(
	commission_id varchar(255) NOT NULL,
    topic varchar(255) NOT NULL,
    description varchar(255) NOT NULL,
    quota_type varchar(255) NOT NULL,
    quota_amount BIGINT(11) UNSIGNED NOT NULL,
    amount_type varchar(255) NOT NULL,
    amount BIGINT(11) UNSIGNED NOT NULL,
    order_type varchar(255) NOT NULL,
    PRIMARY KEY (commission_id)
);

CREATE TABLE orderlist(
	order_id varchar(255) NOT NULL,
    type_car varchar(255) NOT NULL,
    color_car varchar(255) NOT NULL,
    license_car varchar(255) NOT NULL,
    nickname varchar(255) NOT NULL,
    order_status varchar(255) NOT NULL,
    tel char(10) NOT NULL,
    is_booking varchar(255) NOT NULL,
    booking_time BIGINT(11) UNSIGNED NOT NULL,
    arrival_time BIGINT(11) UNSIGNED NOT NULL,
    code varchar(255),
    order_type varchar(255) NOT NULL,
    PRIMARY KEY (order_id)
);

CREATE TABLE make_commission(
    employee_id varchar(255) NOT NULL PRIMARY KEY,
    order_id varchar(255) NOT NULL UNIQUE,
    CONSTRAINT mce 
    FOREIGN KEY (employee_id) 
    REFERENCES employee(employee_id)
    ON UPDATE CASCADE
    ON DELETE NO ACTION
);

ALTER TABLE make_commission
ADD CONSTRAINT mcole
        FOREIGN KEY (order_id)
        REFERENCES orderlist(order_id)
        ON UPDATE CASCADE
        ON DELETE NO ACTION;

CREATE TABLE customer(
	customer_id varchar(255) NOT NULL PRIMARY KEY,
    fname varchar(255) NOT NULL,
    lname varchar(255) NOT NULL,
    email varchar(255) NOT NULL,
    picture_url varchar(255) NOT NULL,
    firstlogin_time BIGINT(11) UNSIGNED NULL,
    lastlogin_time BIGINT(11) UNSIGNED NULL,
    rank varchar(255) NOT NULL,
    customer_type varchar(255) NOT NULL
);

CREATE TABLE make_order(
    customer_id varchar(255) NOT NULL PRIMARY KEY,
    order_id varchar(255) NOT NULL UNIQUE,
    CONSTRAINT moc
    FOREIGN KEY (customer_id) 
    REFERENCES customer(customer_id)
    ON UPDATE CASCADE
    ON DELETE NO ACTION
);

ALTER TABLE make_order
ADD CONSTRAINT mcolc
        FOREIGN KEY (order_id)
        REFERENCES orderlist(order_id)
        ON UPDATE CASCADE
        ON DELETE NO ACTION;

CREATE TABLE package_info(
    package_id varchar(255) NOT NULL PRIMARY KEY,
    package_name varchar(255) NOT NULL,
    package_desciption varchar(255) NOT NULL,
    reduce_type varchar(255) NOT NULL,
    reduce BIGINT(11) UNSIGNED NOT NULL
);

CREATE TABLE buy(
    customer_id varchar(255) NOT NULL PRIMARY KEY,
    package_id varchar(255) NOT NULL UNIQUE,
    time BIGINT(11) UNSIGNED NULL,
    CONSTRAINT bci
    FOREIGN KEY (customer_id)
    REFERENCES customer(customer_id)
    ON UPDATE CASCADE
    ON DELETE NO ACTION
);

ALTER TABLE buy
ADD CONSTRAINT bpi
        FOREIGN KEY (package_id)
        REFERENCES package_info(package_id)
        ON UPDATE CASCADE
        ON DELETE NO ACTION;



CREATE TABLE service(
	service_id varchar(255) NOT NULL PRIMARY KEY,
    name varchar(255) NOT NULL,
    description varchar(255) NOT NULL,
    image varchar(255) NOT NULL,
    commission_id  varchar(255) NOT NULL UNIQUE,
    CONSTRAINT sci
    FOREIGN KEY (commission_id)
    REFERENCES commission(commission_id)
    ON UPDATE CASCADE
    ON DELETE CASCADE
);

CREATE TABLE price_per_type_s(
    service_id varchar(255) NOT NULL PRIMARY KEY,
    type_of_car varchar(255) NOT NULL,
    price BIGINT(11) UNSIGNED NOT NULL,
    CONSTRAINT ppts
    FOREIGN KEY (service_id)
    REFERENCES service(service_id)
    ON UPDATE CASCADE
    ON DELETE CASCADE  
);

CREATE TABLE promotion(
	code varchar(255) NOT NULL PRIMARY KEY,
    name varchar(255) NOT NULL,
    desciption varchar(255) NOT NULL,
    image varchar(255) NOT NULL,
    starttime BIGINT(11) UNSIGNED NULL,
    endtime BIGINT(11) UNSIGNED NULL,
    limitflag BOOLEAN,
    limit_amount int(11),
    limit_type varchar(255),
    dayflag BOOLEAN,
    rankflag boolean,
    rank varchar(255),
    is_member boolean NOT NULL
);

CREATE TABLE price_per_type_p(
    code varchar(255) NOT NULL PRIMARY KEY,
    type_of_car varchar(255) NOT NULL,
    reduce_type varchar(255) NOT NULL,
    reduce BIGINT(11) UNSIGNED NOT NULL,
    CONSTRAINT pptp 
    FOREIGN KEY (code)
    REFERENCES promotion(code)
    ON UPDATE CASCADE
    ON DELETE CASCADE  
);

CREATE TABLE promotion_by_day(
	code varchar(255) NOT NULL PRIMARY KEY,
    day varchar(255) NOT NULL
);

ALTER TABLE promotion_by_day
ADD CONSTRAINT pbdp
    	FOREIGN KEY (code)
    	REFERENCES promotion(code)
    	ON DELETE CASCADE
    	ON UPDATE CASCADE;

CREATE TABLE can_reduce(
	code varchar(255) NOT NULL PRIMARY KEY,
    service_id varchar(255) NOT NULL UNIQUE,
    CONSTRAINT crc
    FOREIGN KEY (code)
    REFERENCES promotion(code)
    ON UPDATE CASCADE
    ON DELETE CASCADE 
);

ALTER TABLE can_reduce
ADD CONSTRAINT crs
        FOREIGN KEY (service_id)
        REFERENCES service(service_id)
        ON UPDATE CASCADE
        ON DELETE CASCADE;

CREATE TABLE included(
	order_id varchar(255) NOT NULL PRIMARY KEY,
    service_id varchar(255) NOT NULL UNIQUE,
    CONSTRAINT clo
    FOREIGN KEY (order_id)
    REFERENCES orderlist(order_id)
    ON UPDATE CASCADE
    ON DELETE NO ACTION
);

ALTER TABLE included
ADD CONSTRAINT cls
        FOREIGN KEY (service_id)
        REFERENCES service(service_id)
        ON UPDATE CASCADE
        ON DELETE NO ACTION;

CREATE TABLE generate_by(
    package_id varchar(255) NOT NULL PRIMARY KEY,
    service_id varchar(255) NOT NULL UNIQUE,
    max BIGINT(11) UNSIGNED NOT NULL,
    CONSTRAINT gbp
    FOREIGN KEY (package_id)
    REFERENCES package_info(package_id)
    ON UPDATE CASCADE
    ON DELETE CASCADE
);

ALTER TABLE generate_by
ADD CONSTRAINT gbs
        FOREIGN KEY (service_id)
        REFERENCES service(service_id)
        ON UPDATE CASCADE
        ON DELETE CASCADE;